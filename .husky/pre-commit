echo ""
echo ">>> Running pre-commit hook... <<<"

echo "1. 🔍 Running ESLint validation on staged files..."

# Run ESLint on staged files
if npm run lint:staged; then
  echo "✅ ESLint validation passed - no linting errors found"
else
  echo "❌ ESLint validation failed - please fix the linting errors"
  echo ""
  echo "Run 'npm run lint:check' to see all linting errors"
  echo "Run 'npm run lint:fix' to auto-fix fixable issues"
  echo ""
  exit 1
fi

echo ""
echo "2. 🛠️  Running build dry run to check compilation..."

# Run nest build dry run (TypeScript compilation check)
if npm run build --silent > /dev/null 2>&1; then  
  # Clean up build artifacts if they were created
  if [ -d "dist" ]; then
    rm -rf dist
    echo "🧹 Cleaned up build artifacts"
  fi
  
  echo ""
  echo "🎉 All validations passed - proceeding with commit!"
  echo "✅ Build dry run successful - code compiles without errors"
  exit 0
else
  echo "❌ Build dry run failed - code has compilation errors"
  echo ""
  echo "Please fix the TypeScript compilation errors before committing."
  echo "Run 'npm run build' to see detailed error messages."
  echo ""
  exit 1
fi
